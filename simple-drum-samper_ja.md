# Simple Drum sampler
## 概要
noteで公開されているハギヲさんの[1100円で作るTR-808/909 サンプルプレイヤードラムモジュール-モジュラーシンセ自作｜HAGIWO/ハギヲ｜note](https://note.com/solder_state/n/n0209d16d0d08)を参考に製作しました。
ただし、私の環境では動作が不安定だったため、コードの修正を試みましたがほぼ全てを新しく作ることになりました。

その偉大なプログラムとの違いはこうです：
・OLEDを除去しました。
・6chにしました。
・ライブラリを無くしました。
・delayをmicrosタイマーに変更しました。


## 動作について

### トリガー 
1.5V以上のHIGH電圧が必要です。
トリガー入力については、単純にdigitalReadを判定するのではなく、
入力の値からビットの配列を作り、初めに定義したビットマスクを使って判定します。
ビットの数は判定サイクルの回数を指します。
例えば、判定に4cycle必要ならばこう定義します：

```
0x00001111
```

### サンプル

サンプルのデータは、コンパクトなものである必要があります。
これは8bitのbyteアレイとして、samples.hに格納します。
まず、サンプルをAudacityやSoundForgeなどでPCMに変換します。
Audacityの場合、「その他の形式」で書き出しをして、Unsigned 8bit, RAW(header less)を選択します。
また音声はモノラルで0.5秒以内である必要があります。
RAWファイルが完成したら、次にHEXアレイに変換します。
[File to hex converter](http://tomeko.net/online_tools/file_to_hex.php?lang=en)などを使うと良いでしょう。

変換した配列を、定義されている配列にペーストしていきます。
Samples.hの `// ….`と書かれたところにそれぞれペーストします。

```cpp
const uint8_t samples_A[] PROGMEM =
{
  // ....
}
```

~~サンプルプログラムには、ES2で作成したサンプルを入れてあります。~~
808やCR-78などのアナログマシンより、PCMドラムマシンのサンプルを用いる方がルネサンスであると感じています。
個人で楽しむなら、ネットに公開されているLinnやOberheimのbinファイルを変換して使うことができます。

### Testing

プログラムをテストする時、XIAOと1k抵抗、0.1uFのコンデンサのみを用いましたが、
Eurorackシステムに統合させる場合はハギヲさんのような回路を組むことを推奨します。おそらく、そのまま流用しても上手く動作すると思います。

```
[XIAO] pin 0 --> 220ohm --> 1uF --> GND
                   |--------------> OUTPUT
```

## ToDo
このプログラムは、休日の間に書いたものなので、まだ追加したい機能が沢山あります。
今後の展望としてここにアイデアを記しておきます。
もし可能なら、Pullリクエストをくれると嬉しいです。

* VolumeとFrequencyのPOT（もうすぐ出来ます）
* 入力トリガーの極性反転機能


## 謝辞
ほぼオリジナルのプログラムですが、
インスピレーションを与えてくれたHAGIWO氏に敬意を表してフォークしようと考えましたが、
GitHubにコードを公開していなかったので、全く新しく作りました。
また、簡単なコードですので、CC0として公開します。
